<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Luis E. Ascencio G.">
<meta name="keywords" content="Series de Tiempo, ARIMA, Python, R, Estadistica">

<title>Taller - Series de Tiempo y Python IIE - UNAM</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="sesion2_files/libs/clipboard/clipboard.min.js"></script>
<script src="sesion2_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="sesion2_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="sesion2_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="sesion2_files/libs/quarto-html/popper.min.js"></script>
<script src="sesion2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="sesion2_files/libs/quarto-html/anchor.min.js"></script>
<link href="sesion2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sesion2_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="sesion2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="sesion2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="sesion2_files/libs/bootstrap/bootstrap-6afd44f53177509fd16e44e34096eacb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="sesion2.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Taller - Series de Tiempo y Python IIE - UNAM</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Luis E. Ascencio G. <a href="mailto:luis.ascencio@cimat.mx" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0009-0009-1694-5993" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.cimat.mx">
            CIMAT
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    <p>Este Notebook incluye una introduccion al manejo de Series de Tiempo con Python</p>
  </div>
</div>

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>Series de Tiempo, ARIMA, Python, R, Estadistica</p>
  </div>
</div>

</header>


<section id="librerías-y-configuración-de-entorno" class="level1">
<h1>Librerías y Configuración de entorno</h1>
<div id="1dd80e04" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np <span class="co"># Libreria Matematica basica</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd <span class="co"># Libreria para manejo, manipulacion y visualizacion de datos </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas <span class="im">import</span> read_excel <span class="co"># funcion para leer archivos de excel</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl <span class="co"># Libreria para visualizacion de datos y graficas</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt   <span class="co"># Funcion para graficar </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns             <span class="co"># Libreria para visualizacion de datos</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="introducción---manejo-de-datos-básico" class="level1">
<h1>Introducción - Manejo de Datos (Básico)</h1>
<p>En esta parte vamos introducir el manejo básico de archivos de texto que pueden contener información asociada a una serie de tiempos, para ello primero instalamos los requerimientos de software.</p>
<div id="6fe0e98b" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">'AirPassengers.csv'</span>  <span class="co"># Directorio en el que se encuentra el documento</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(path)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>df.tail()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Month</th>
<th data-quarto-table-cell-role="th">#Passengers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">139</th>
<td>1960-08</td>
<td>606</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">140</th>
<td>1960-09</td>
<td>508</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">141</th>
<td>1960-10</td>
<td>461</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">142</th>
<td>1960-11</td>
<td>390</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">143</th>
<td>1960-12</td>
<td>432</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>De manera similar podemos abrir un archivo tipo .xls y con ello tenemos los 2 archivos mas comunes y básicos de los cuales podemos obtener datos</p>
<p>Nota: En entornos más avanzados es necesario gestionar provenientes de bases de datos, lo cual escapa de las fronteras abarcadas por este curso.</p>
<div id="9806c1d7" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !conda install xlrd -y   # Libreria necesaria para poder abrir xls.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install xlrd -y   # Libreria necesaria para poder abrir xls.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> read_excel(<span class="st">'AirlineSales.xls'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>df1.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Dates</th>
<th data-quarto-table-cell-role="th">Observations</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1971-01-01</td>
<td>112</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1971-02-01</td>
<td>118</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1971-03-01</td>
<td>132</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1971-04-01</td>
<td>129</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1971-05-01</td>
<td>121</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="938301cc" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! conda install openpyxl -y </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ejemplo2 <span class="op">=</span> read_excel(<span class="st">'ClayBricks.xls'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>ejemplo3 <span class="op">=</span> read_excel(<span class="st">'Electricity.xls'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>ejemplo4 <span class="op">=</span> read_excel(<span class="st">'MilkProduction.xls'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>ejemplo5 <span class="op">=</span> read_excel(<span class="st">'JapaneseCars.xls'</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>ejemplo6 <span class="op">=</span> read_excel(<span class="st">'HouseSales.xls'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="edicion-de-datos-y-graficas-con-pandas" class="level2">
<h2 class="anchored" data-anchor-id="edicion-de-datos-y-graficas-con-pandas">Edicion de datos y Graficas con Pandas</h2>
<p>Ahora editemos un par datos de nuestros “Data Frames”</p>
<div id="950912bb" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> [<span class="st">'Fechas'</span>,<span class="st">'Numero de Pasajeros'</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Fechas</th>
<th data-quarto-table-cell-role="th">Numero de Pasajeros</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1949-01</td>
<td>112</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>1949-02</td>
<td>118</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>1949-03</td>
<td>132</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>1949-04</td>
<td>129</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>1949-05</td>
<td>121</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="bdf35544" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df1.columns <span class="op">=</span> [<span class="st">'Fechas'</span>,<span class="st">'Numero de Pasajeros'</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df1.tail()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Fechas</th>
<th data-quarto-table-cell-role="th">Numero de Pasajeros</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">91</th>
<td>1978-08-01</td>
<td>405</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">92</th>
<td>1978-09-01</td>
<td>355</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">93</th>
<td>1978-10-01</td>
<td>306</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">94</th>
<td>1978-11-01</td>
<td>271</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">95</th>
<td>1978-12-01</td>
<td>306</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>A continuacion vemos que de manera muy sencilla podemos graficar nuestras series de tiempo solamente usando la libreria de Pandas y MatPlotLib cuyo resultado a constinuacion es simple y con poco formato.</p>
<div id="9f19e3b8" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.plot()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="eb217bbe" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df1[<span class="st">"Numero de Pasajeros"</span>].plot()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Para tener una mejor presentacion de los datos vamos a definimos una funcion para graficar nuestros Data Frames/ Series de tiempo.</p>
<div id="9dcca394" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_df(df, x, y, title<span class="op">=</span><span class="st">""</span>, xlabel<span class="op">=</span><span class="st">'Fecha'</span>, ylabel<span class="op">=</span><span class="st">'Numero de Pasajeros'</span>, colores<span class="op">=</span><span class="st">""</span>, dpi<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">4</span>), dpi<span class="op">=</span>dpi)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, y, color<span class="op">=</span>colores)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    plt.gca().<span class="bu">set</span>(title<span class="op">=</span>title, xlabel<span class="op">=</span>xlabel, ylabel<span class="op">=</span>ylabel)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="10be1297" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>plot_df(df, x<span class="op">=</span>df[<span class="st">'Fechas'</span>], y<span class="op">=</span>df[<span class="st">'Numero de Pasajeros'</span>], title<span class="op">=</span><span class="st">'Tendencia y Temporalidad'</span>, colores<span class="op">=</span><span class="st">"blue"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Para el segundo Data Frame</p>
<div id="00c241bf" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>plot_df(df1, x<span class="op">=</span>df1[<span class="st">'Fechas'</span>], y<span class="op">=</span>df1[<span class="st">'Numero de Pasajeros'</span>], title<span class="op">=</span><span class="st">'Tendencia y Temporalidad'</span>, colores<span class="op">=</span><span class="st">"green"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="graficas-de-ejemplos" class="level2">
<h2 class="anchored" data-anchor-id="graficas-de-ejemplos">Graficas de Ejemplos</h2>
<div id="b82870b1" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plot_df(ejemplo2, x<span class="op">=</span>ejemplo2[<span class="st">'Dates'</span>], y<span class="op">=</span>ejemplo2[<span class="st">'Bricks'</span>],ylabel<span class="op">=</span><span class="st">"Ladrillos"</span>, title<span class="op">=</span><span class="st">'Tendencia y Temporalidad'</span>, colores<span class="op">=</span><span class="st">"red"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-13-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2b3d5bd0" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plot_df(ejemplo3, x<span class="op">=</span>ejemplo3[<span class="st">'Month and year'</span>], y<span class="op">=</span>ejemplo3[<span class="st">'Kwh'</span>],ylabel<span class="op">=</span><span class="st">"KiloWatts Hora"</span> ,title<span class="op">=</span><span class="st">'Tendencia y Temporalidad'</span>, colores<span class="op">=</span><span class="st">"cyan"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="manejo-de-archivos-r-y-graficas" class="level2">
<h2 class="anchored" data-anchor-id="manejo-de-archivos-r-y-graficas">Manejo de Archivos R y Graficas</h2>
<p>Ahora vamos a ver como abrir archivos con datos asociados a ST en R, para ello instalamos la siguente libreria en Python o en su defecto trabajar directamente con R Studio o agun FrameWork para R.</p>
<div id="f26e7907" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install rpy2</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext rpy2.ipython</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Instalamos e importamos liberias de R que necesitaremos</p>
<div id="ede6e6b3" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rpy2.robjects.packages <span class="im">import</span> importr, data</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>utils <span class="op">=</span> importr(<span class="st">'utils'</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>base <span class="op">=</span> importr(<span class="st">'base'</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages('stats')</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages('lme4')</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages("ggplot2")</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages("tseries")</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages("fable")</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages("tsibble")</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages("dplyr")</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages("lubridate")</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages("feasts")</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># library(fable) # en un entorno nativo de R se cargan las liberias asi. </span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">#feasts = importr("feasts")</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>lubridate <span class="op">=</span> importr(<span class="st">"lubridate"</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>dplyr <span class="op">=</span> importr(<span class="st">"dplyr"</span>)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">#tsibble = importr("tsibble")</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">#fable = importr("fable")</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co">#tseries= importr("tseries")</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> importr(<span class="st">'stats'</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">#lme4 = importr('lme4')</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplot2 = importr("ggplot2")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="fe448001" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>airline <span class="op">&lt;-</span> read.csv(<span class="st">'AirPassengers.csv'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>head(airline)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Month X.Passengers
1 1949-01          112
2 1949-02          118
3 1949-03          132
4 1949-04          129
5 1949-05          121
6 1949-06          135</code></pre>
</div>
</div>
<div id="90ca5a16" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>airline_TS <span class="op">&lt;-</span> ts(airline$X.Passengers,frequency <span class="op">=</span> <span class="dv">12</span>, start <span class="op">=</span> c(<span class="dv">1949</span>, <span class="dv">1</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>airline_TS</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1949 112 118 132 129 121 135 148 148 136 119 104 118
1950 115 126 141 135 125 149 170 170 158 133 114 140
1951 145 150 178 163 172 178 199 199 184 162 146 166
1952 171 180 193 181 183 218 230 242 209 191 172 194
1953 196 196 236 235 229 243 264 272 237 211 180 201
1954 204 188 235 227 234 264 302 293 259 229 203 229
1955 242 233 267 269 270 315 364 347 312 274 237 278
1956 284 277 317 313 318 374 413 405 355 306 271 306
1957 315 301 356 348 355 422 465 467 404 347 305 336
1958 340 318 362 348 363 435 491 505 404 359 310 337
1959 360 342 406 396 420 472 548 559 463 407 362 405
1960 417 391 419 461 472 535 622 606 508 461 390 432</code></pre>
</div>
</div>
<div id="b137e7c3" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plot(airline_TS,<span class="bu">type</span><span class="op">=</span><span class="st">'o'</span>,ylab<span class="op">=</span><span class="st">'Numero de Pasajeros'</span>,main<span class="op">=</span><span class="st">'Serie de Tiempos Aerolinea'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-19-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="descomposición-de-series-de-tiempo" class="level1">
<h1>Descomposición de Series de Tiempo</h1>
<p>En esta parte vamos a ver código que nos genera automáticamente una descomposición de las series temporales que tengamos a nuestra disposición. Lo primero que vamos a hacer es importar la librería statsmodels cuyas rutinas nos serán útiles para modelar ST.</p>
<div id="4ac059f5" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! conda install statsmodels -y</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Sabemos que una serie temporal se puede descomponer considerando lo siguiente <span class="math inline">\(X_t =f(T_t,S_t,N_t)\)</span>. Los modelos más sencillos consisten en consideran una función aditiva <span class="math inline">\(X_t =T_t+S_t+N_t\)</span> o multiplicativa $S_t =T_t S_t N_t $, cuyos ejemplos prácticos e implementados automáticamente los encontramos en los siguientes códigos.</p>
</section>
<section id="tendencias" class="level1">
<h1>Tendencias</h1>
<p>existen multiples estrategias para estimar la tendencia de una serie de tiempo, cada una es adaptable dependiendop del tipo de serie que se tenga y el fenomeno que se intenta modelar. Las estrategias mas comunes son las siguientes:</p>
<ul>
<li>Calcular la media de los datos.</li>
<li>Usar algun modelo de regresion.</li>
<li>Calcular medias moviles dependiendo de patrones estacionales.</li>
</ul>
<p>A continuacion vemos como hacer estos calculos para la TS del ejemplo 2 y 3.</p>
<div id="dc293cec" class="cell" data-execution_count="58">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ejemplo2[<span class="st">"Bricks"</span>].mean()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>np.float64(408.7935483870968)</code></pre>
</div>
</div>
<div id="680058fe" class="cell" data-execution_count="59">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ejemplo3[<span class="st">"Kwh"</span>].mean()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>np.float64(6903.0672268907565)</code></pre>
</div>
</div>
<section id="medias-moviles" class="level2">
<h2 class="anchored" data-anchor-id="medias-moviles">Medias Moviles</h2>
<p>Para calcular medias moviles con Pandas</p>
<div id="24b92bb4" class="cell" data-execution_count="60">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ma_eje1 <span class="op">=</span> ejemplo2[<span class="st">"Bricks"</span>].rolling(<span class="dv">6</span>).mean()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>std_ma_eje1 <span class="op">=</span> ejemplo2[<span class="st">"Bricks"</span>].rolling(<span class="dv">6</span>).std()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Definimos una funcion para graficar la media movil</p>
<div id="c48da21a" class="cell" data-execution_count="61">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_ts2(df, x, y, title<span class="op">=</span><span class="st">""</span>, xlabel<span class="op">=</span><span class="st">'Fecha'</span>, ylabel<span class="op">=</span><span class="st">'Numero de Pasajeros'</span>, colores<span class="op">=</span><span class="st">""</span>, dpi<span class="op">=</span><span class="dv">100</span>,MA<span class="op">=</span><span class="dv">6</span>):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    ma<span class="op">=</span> y.rolling(MA).mean()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    std_ma<span class="op">=</span>y.rolling(MA).std()</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">4</span>), dpi<span class="op">=</span>dpi)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, ma<span class="op">+</span>std_ma, color<span class="op">=</span><span class="st">"cyan"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, ma<span class="op">-</span>std_ma, color<span class="op">=</span><span class="st">"cyan"</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    plt.fill_between(x, y1<span class="op">=</span>ma<span class="op">+</span>std_ma, y2<span class="op">=</span>ma<span class="op">-</span>std_ma, alpha<span class="op">=</span><span class="fl">0.3</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'cyan'</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, ma, color<span class="op">=</span><span class="st">"red"</span>, label<span class="op">=</span><span class="st">"Media Movil"</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, y, color<span class="op">=</span>colores, label<span class="op">=</span><span class="st">"Original"</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    plt.gca().<span class="bu">set</span>(title<span class="op">=</span>title, xlabel<span class="op">=</span>xlabel, ylabel<span class="op">=</span>ylabel)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">"best"</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="2a2484f9" class="cell" data-execution_count="62">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>plot_ts2(ejemplo2, ejemplo2[<span class="st">"Dates"</span>],ejemplo2[<span class="st">"Bricks"</span>], title<span class="op">=</span><span class="st">"Medias Moviles Ladrillos"</span>, xlabel<span class="op">=</span><span class="st">'Fecha'</span>, ylabel<span class="op">=</span><span class="st">'Numero de Ladrillos'</span>, colores<span class="op">=</span><span class="st">"black"</span>,MA<span class="op">=</span><span class="dv">24</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Creamos una grafica interactiva variando la ventana para el calculo de la media movil</p>
<div id="5b9e98f2" class="cell" data-execution_count="66">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ipywidgets <span class="im">as</span> widgets</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> graf_ma(l):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    w<span class="op">=</span>plot_ts2(ejemplo2, ejemplo2[<span class="st">"Dates"</span>],ejemplo2[<span class="st">"Bricks"</span>], title<span class="op">=</span><span class="st">"Medias Moviles Ladrillos"</span>, xlabel<span class="op">=</span><span class="st">'Fecha'</span>, ylabel<span class="op">=</span><span class="st">'Numero de Ladrillos'</span>, colores<span class="op">=</span><span class="st">"black"</span>,MA<span class="op">=</span>l)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="2d7270ef" class="cell" data-execution_count="67">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>widgets.interact(graf_ma, l<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">24</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"10a19dd4bb1647c0b79d00d149b9747e","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>&lt;function __main__.graf_ma(l)&gt;</code></pre>
</div>
</div>
</section>
<section id="usando-r" class="level2">
<h2 class="anchored" data-anchor-id="usando-r">Usando R</h2>
<div id="fa7620e5" class="cell" data-execution_count="68">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>BricksTS</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1946         189 204 208 197 187 214 227 223 199 229
1947 249 234 208 253 267 255 242 268 290 277 241 253
1948 265 236 229 265 275 258 231 263 308 313 293 328
1949 349 340 309 349 366 340 302 350 362 337 326 358
1950 359 357 341 380 404 409 383 417 454 428 386 428
1951 434 417 385 433 453 436 399 461 476 477 452 461
1952 534 516 478 526 518 417 340 437 459 449 424 501
1953 540 533 457 513 522 478 421 487 470 482 458 526
1954 573 563 513 551 589 564 519 581 581 578 500 560
1955 512 412 303 409 420 413 400 469 482 484 447 507
1956 533 503 443 503 505 443 415 485 495 458 427 519
1957 555 539 511 572 570 526 472 524 497 460 373 436
1958 424 430 387 413 451 420 394 462 476 443 421 472
1959 494                                            </code></pre>
</div>
</div>
</section>
</section>
<section id="descomposicion-con-paquetes-de-software" class="level1">
<h1>Descomposicion con Paquetes de Software</h1>
<p>Hacemos la descomposicion de la serie de tiempos de pasajeros de aerolinea.</p>
<div id="6a07eb6b" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiplicative Decomposition </span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>multiplicative_decomposition <span class="op">=</span> seasonal_decompose(df[<span class="st">'Numero de Pasajeros'</span>], model<span class="op">=</span><span class="st">'multiplicative'</span>, period<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive Decomposition</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>additive_decomposition <span class="op">=</span> seasonal_decompose(df[<span class="st">'Numero de Pasajeros'</span>], model<span class="op">=</span><span class="st">'additive'</span>, period<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'figure.figsize'</span>: (<span class="dv">16</span>,<span class="dv">12</span>)})</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>multiplicative_decomposition.plot().suptitle(<span class="st">'Descomposición Multiplicativa'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>additive_decomposition.plot().suptitle(<span class="st">'Descomposición Aditiva'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-29-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Hacemos descomposicion de la serie de tiempo de ladrillos</p>
<div id="f3262ff6" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiplicative Decomposition </span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>multiplicative_decomposition2 <span class="op">=</span> seasonal_decompose(ejemplo2[<span class="st">'Bricks'</span>], model<span class="op">=</span><span class="st">'multiplicative'</span>, period<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive Decomposition</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>additive_decomposition2 <span class="op">=</span> seasonal_decompose(ejemplo2[<span class="st">'Bricks'</span>], model<span class="op">=</span><span class="st">'additive'</span>, period<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'figure.figsize'</span>: (<span class="dv">16</span>,<span class="dv">12</span>)})</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>multiplicative_decomposition2.plot().suptitle(<span class="st">'Descomposición Multiplicativa'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>additive_decomposition2.plot().suptitle(<span class="st">'Descomposición Aditiva'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-30-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Descomposicion de la serie de consumo de energia</p>
<div id="b106d83a" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiplicative Decomposition </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>multiplicative_decomposition3 <span class="op">=</span> seasonal_decompose(ejemplo3[<span class="st">'Kwh'</span>], model<span class="op">=</span><span class="st">'multiplicative'</span>, period<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Additive Decomposition</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>additive_decomposition3 <span class="op">=</span> seasonal_decompose(ejemplo3[<span class="st">'Kwh'</span>], model<span class="op">=</span><span class="st">'additive'</span>, period<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'figure.figsize'</span>: (<span class="dv">16</span>,<span class="dv">12</span>)})</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>multiplicative_decomposition3.plot().suptitle(<span class="st">'Descomposición Multiplicativa'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>additive_decomposition3.plot().suptitle(<span class="st">'Descomposición Aditiva'</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(rect<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>, <span class="dv">1</span>, <span class="fl">0.95</span>])</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-31-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="descomposicion-en-r" class="level1">
<h1>Descomposicion en R</h1>
<div id="9c832210" class="cell" data-execution_count="51">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages("readxl")</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#utils.install_packages("TSstudio")</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#TSstudio = importr("TSstudio")    </span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>readxl <span class="op">=</span> importr(<span class="st">"readxl"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="7bad3872" class="cell" data-execution_count="52">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Abrimos los archivos .xls</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>Bricks <span class="op">&lt;-</span> read_excel(<span class="st">'ClayBricks.xls'</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>Electricity <span class="op">&lt;-</span> read_excel(<span class="st">'Electricity.xls'</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Construimos la TS </span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>BricksTS <span class="op">&lt;-</span> ts(Bricks$Bricks,frequency <span class="op">=</span> <span class="dv">12</span>, start <span class="op">=</span> c(<span class="dv">1946</span>, <span class="dv">3</span>))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>ElectricityTS <span class="op">&lt;-</span> ts(Electricity$Kwh,frequency <span class="op">=</span> <span class="dv">12</span>, start <span class="op">=</span> c(<span class="dv">1956</span>, <span class="dv">1</span>))</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">#plot.ts(BricksTS)</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>plot.ts(ElectricityTS)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ts_decompose(BricksTS, type = "both")</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>Bricks</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 155 × 2
   Dates               Bricks
   &lt;dttm&gt;               &lt;dbl&gt;
 1 1956-03-01 00:00:00    189
 2 1956-04-01 00:00:00    204
 3 1956-05-01 00:00:00    208
 4 1956-06-01 00:00:00    197
 5 1956-07-01 00:00:00    187
 6 1956-08-01 00:00:00    214
 7 1956-09-01 00:00:00    227
 8 1956-10-01 00:00:00    223
 9 1956-11-01 00:00:00    199
10 1956-12-01 00:00:00    229
# ℹ 145 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Además: Hubo 22 avisos (use warnings() para verlos)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-33-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="2f25d3a0" class="cell" data-execution_count="53">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>BricksTS</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1946         189 204 208 197 187 214 227 223 199 229
1947 249 234 208 253 267 255 242 268 290 277 241 253
1948 265 236 229 265 275 258 231 263 308 313 293 328
1949 349 340 309 349 366 340 302 350 362 337 326 358
1950 359 357 341 380 404 409 383 417 454 428 386 428
1951 434 417 385 433 453 436 399 461 476 477 452 461
1952 534 516 478 526 518 417 340 437 459 449 424 501
1953 540 533 457 513 522 478 421 487 470 482 458 526
1954 573 563 513 551 589 564 519 581 581 578 500 560
1955 512 412 303 409 420 413 400 469 482 484 447 507
1956 533 503 443 503 505 443 415 485 495 458 427 519
1957 555 539 511 572 570 526 472 524 497 460 373 436
1958 424 430 387 413 451 420 394 462 476 443 421 472
1959 494                                            </code></pre>
</div>
</div>
<div id="0f22da9a" class="cell" data-execution_count="54">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>BricksTS_Da <span class="op">&lt;-</span> decompose(BricksTS)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>BricksTS_Da</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$x
     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1946         189 204 208 197 187 214 227 223 199 229
1947 249 234 208 253 267 255 242 268 290 277 241 253
1948 265 236 229 265 275 258 231 263 308 313 293 328
1949 349 340 309 349 366 340 302 350 362 337 326 358
1950 359 357 341 380 404 409 383 417 454 428 386 428
1951 434 417 385 433 453 436 399 461 476 477 452 461
1952 534 516 478 526 518 417 340 437 459 449 424 501
1953 540 533 457 513 522 478 421 487 470 482 458 526
1954 573 563 513 551 589 564 519 581 581 578 500 560
1955 512 412 303 409 420 413 400 469 482 484 447 507
1956 533 503 443 503 505 443 415 485 495 458 427 519
1957 555 539 511 572 570 526 472 524 497 460 373 436
1958 424 430 387 413 451 420 394 462 476 443 421 472
1959 494                                            

$seasonal
            Jan        Feb        Mar        Apr        May        Jun
1946                       -36.037800  12.583728  25.465672  -7.898911
1947  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1948  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1949  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1950  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1951  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1952  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1953  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1954  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1955  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1956  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1957  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1958  30.851089   8.687895 -36.037800  12.583728  25.465672  -7.898911
1959  30.851089                                                       
            Jul        Aug        Sep        Oct        Nov        Dec
1946 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1947 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1948 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1949 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1950 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1951 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1952 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1953 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1954 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1955 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1956 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1957 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1958 -46.343355   7.992188  18.111506   5.448311 -32.787800  13.927478
1959                                                                  

$trend
          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1946                         NA       NA       NA       NA       NA       NA
1947 231.0417 235.5833 240.4583 245.3333 249.3333 252.0833 253.7500 254.5000
1948 257.7917 257.1250 257.6667 259.9167 263.5833 268.8750 275.5000 283.3333
1949 318.7083 325.2917 331.1667 334.4167 336.7917 339.4167 341.0833 342.2083
1950 360.4583 366.6250 373.2500 380.8750 387.1667 392.5833 398.6250 404.2500
1951 421.8333 424.3333 427.0833 430.0417 434.8333 438.9583 444.5000 452.7917
1952 473.7917 470.3333 468.6250 466.7500 464.4167 464.9167 466.8333 467.7917
1953 474.4583 479.9167 482.4583 484.2917 487.0833 489.5417 491.9583 494.5833
1954 520.5000 528.5000 537.0417 545.6667 551.4167 554.5833 553.4583 544.6250
1955 477.3750 467.7500 458.9583 450.9167 444.7917 440.3750 439.0417 443.7083
1956 477.2083 478.5000 479.7083 479.1667 477.2500 476.9167 478.3333 480.7500
1957 508.3750 512.3750 514.0833 514.2500 512.0833 506.3750 497.4583 487.4583
1958 437.3333 431.5000 428.0417 426.4583 427.7500 431.2500 435.6667       NA
1959       NA                                                               
          Sep      Oct      Nov      Dec
1946 214.1250 216.9583 221.4583 226.3333
1947 255.4583 256.8333 257.6667 258.1250
1948 291.0000 297.8333 305.1250 312.3333
1949 344.2500 346.8750 349.7500 354.2083
1950 408.5833 412.6250 416.8750 420.0417
1951 460.7917 468.5417 475.1250 477.0417
1952 467.6250 466.2083 465.8333 468.5417
1953 498.1667 502.0833 506.4583 512.8333
1954 529.5833 514.9167 501.9583 488.6250
1955 453.3333 463.0833 470.5417 475.3333
1956 485.0833 490.7917 496.3750 502.5417
1957 477.7500 465.9583 454.3750 445.0000
1958       NA       NA       NA       NA
1959                                    

$random
              Jan          Feb          Mar          Apr          May
1946                                     NA           NA           NA
1947  -12.8927557  -10.2712279    3.5794665   -4.9170612   -7.7990057
1948  -23.6427557  -29.8128946    7.3711332   -7.5003946  -14.0490057
1949   -0.5594223    6.0204388   13.8711332    1.9996054    3.7426610
1950  -32.3094223  -18.3128946    3.7877999  -13.4587279   -8.6323390
1951  -18.6844223  -16.0212279   -6.0455335   -9.6253946   -7.2990057
1952   29.3572443   36.9787721   45.4127999   46.6662721   28.1176610
1953   34.6905777   44.3954388   10.5794665   16.1246054    9.4509943
1954   21.6489110   25.8121054   11.9961332   -7.2503946   12.1176610
1955    3.7739110  -64.4378946 -119.9205335  -54.5003946  -50.2573390
1956   24.9405777   15.8121054   -0.6705335   11.2496054    2.2843277
1957   15.7739110   17.9371054   32.9544665   45.1662721   32.4509943
1958  -44.1844223  -10.1878946   -5.0038668  -26.0420612   -2.2156723
1959           NA                                                    
              Jun          Jul          Aug          Sep          Oct
1946           NA           NA           NA   -5.2365057    0.5933554
1947   10.8155777   34.5933554    5.5078125   16.4301610   14.7183554
1948   -2.9760890    1.8433554  -28.3255208   -1.1115057    9.7183554
1949    8.4822443    7.2600221   -0.2005208   -0.3615057  -15.3233112
1950   24.3155777   30.7183554    4.7578125   27.3051610    9.9266888
1951    4.9405777    0.8433554    0.2161458   -2.9031723    3.0100221
1952  -40.0177557  -80.4899779  -38.7838542  -26.7365057  -22.6566446
1953   -3.6427557  -24.6149779  -15.5755208  -46.2781723  -25.5316446
1954   17.3155777   11.8850221   28.3828125   33.3051610   57.6350221
1955  -19.4760890    7.3016888   17.2994792   10.5551610   15.4683554
1956  -26.0177557  -16.9899779   -3.7421875   -8.1948390  -38.2399779
1957   27.5239110   20.8850221   28.5494792    1.1384943  -11.4066446
1958   -3.3510890    4.6766888           NA           NA           NA
1959                                                                 
              Nov          Dec
1946   10.3294665  -11.2608112
1947   16.1211332  -19.0524779
1948   20.6627999    1.7391888
1949    9.0377999  -10.1358112
1950    1.9127999   -5.9691446
1951    9.6627999  -29.9691446
1952   -9.0455335   18.5308554
1953  -15.6705335   -0.7608112
1954   30.8294665   57.4475221
1955    9.2461332   17.7391888
1956  -36.5872001    2.5308554
1957  -48.5872001  -22.9274779
1958           NA           NA
1959                          

$figure
 [1] -36.037800  12.583728  25.465672  -7.898911 -46.343355   7.992188
 [7]  18.111506   5.448311 -32.787800  13.927478  30.851089   8.687895

$type
[1] "additive"

attr(,"class")
[1] "decomposed.ts"</code></pre>
</div>
</div>
<div id="20cbe7dc" class="cell" data-execution_count="55">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>plot(BricksTS_Da)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="b5ae6038" class="cell" data-execution_count="56">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>BricksTS_Dm <span class="op">&lt;-</span> decompose(BricksTS,<span class="bu">type</span> <span class="op">=</span> <span class="st">"multiplicative"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>BricksTS_Dm</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$x
     Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
1946         189 204 208 197 187 214 227 223 199 229
1947 249 234 208 253 267 255 242 268 290 277 241 253
1948 265 236 229 265 275 258 231 263 308 313 293 328
1949 349 340 309 349 366 340 302 350 362 337 326 358
1950 359 357 341 380 404 409 383 417 454 428 386 428
1951 434 417 385 433 453 436 399 461 476 477 452 461
1952 534 516 478 526 518 417 340 437 459 449 424 501
1953 540 533 457 513 522 478 421 487 470 482 458 526
1954 573 563 513 551 589 564 519 581 581 578 500 560
1955 512 412 303 409 420 413 400 469 482 484 447 507
1956 533 503 443 503 505 443 415 485 495 458 427 519
1957 555 539 511 572 570 526 472 524 497 460 373 436
1958 424 430 387 413 451 420 394 462 476 443 421 472
1959 494                                            

$seasonal
           Jan       Feb       Mar       Apr       May       Jun       Jul
1946                     0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1947 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1948 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1949 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1950 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1951 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1952 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1953 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1954 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1955 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1956 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1957 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1958 1.0715541 1.0151491 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431
1959 1.0715541                                                            
           Aug       Sep       Oct       Nov       Dec
1946 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1947 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1948 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1949 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1950 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1951 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1952 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1953 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1954 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1955 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1956 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1957 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1958 1.0176729 1.0509676 1.0175704 0.9216109 1.0311689
1959                                                  

$trend
          Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
1946                         NA       NA       NA       NA       NA       NA
1947 231.0417 235.5833 240.4583 245.3333 249.3333 252.0833 253.7500 254.5000
1948 257.7917 257.1250 257.6667 259.9167 263.5833 268.8750 275.5000 283.3333
1949 318.7083 325.2917 331.1667 334.4167 336.7917 339.4167 341.0833 342.2083
1950 360.4583 366.6250 373.2500 380.8750 387.1667 392.5833 398.6250 404.2500
1951 421.8333 424.3333 427.0833 430.0417 434.8333 438.9583 444.5000 452.7917
1952 473.7917 470.3333 468.6250 466.7500 464.4167 464.9167 466.8333 467.7917
1953 474.4583 479.9167 482.4583 484.2917 487.0833 489.5417 491.9583 494.5833
1954 520.5000 528.5000 537.0417 545.6667 551.4167 554.5833 553.4583 544.6250
1955 477.3750 467.7500 458.9583 450.9167 444.7917 440.3750 439.0417 443.7083
1956 477.2083 478.5000 479.7083 479.1667 477.2500 476.9167 478.3333 480.7500
1957 508.3750 512.3750 514.0833 514.2500 512.0833 506.3750 497.4583 487.4583
1958 437.3333 431.5000 428.0417 426.4583 427.7500 431.2500 435.6667       NA
1959       NA                                                               
          Sep      Oct      Nov      Dec
1946 214.1250 216.9583 221.4583 226.3333
1947 255.4583 256.8333 257.6667 258.1250
1948 291.0000 297.8333 305.1250 312.3333
1949 344.2500 346.8750 349.7500 354.2083
1950 408.5833 412.6250 416.8750 420.0417
1951 460.7917 468.5417 475.1250 477.0417
1952 467.6250 466.2083 465.8333 468.5417
1953 498.1667 502.0833 506.4583 512.8333
1954 529.5833 514.9167 501.9583 488.6250
1955 453.3333 463.0833 470.5417 475.3333
1956 485.0833 490.7917 496.3750 502.5417
1957 477.7500 465.9583 454.3750 445.0000
1958       NA       NA       NA       NA
1959                                    

$random
           Jan       Feb       Mar       Apr       May       Jun       Jul
1946                            NA        NA        NA        NA        NA
1947 1.0057614 0.9784564 0.9505620 1.0021680 1.0096513 1.0293562 1.0692326
1948 0.9593187 0.9041445 0.9766393 0.9908053 0.9836831 0.9764250 0.9400550
1949 1.0219224 1.0296180 1.0253422 1.0141778 1.0246139 1.0193313 0.9926801
1950 0.9294484 0.9592158 1.0039487 0.9695667 0.9838387 1.0601348 1.0772019
1951 0.9601404 0.9680529 0.9906154 0.9784845 0.9822360 1.0107245 1.0063846
1952 1.0518159 1.0807223 1.1208807 1.0951611 1.0516287 0.9127053 0.8165446
1953 1.0621396 1.0940358 1.0409104 1.0294066 1.0104334 0.9935915 0.9594374
1954 1.0273533 1.0493819 1.0497028 0.9812976 1.0071076 1.0348607 1.0513451
1955 1.0009127 0.8676680 0.7254815 0.8814620 0.8902933 0.9543266 1.0214500
1956 1.0423297 1.0355145 1.0148069 1.0201357 0.9976677 0.9452155 0.9727031
1957 1.0188135 1.0362654 1.0923060 1.0809318 1.0494813 1.0570198 1.0637710
1958 0.9047721 0.9816526 0.9935320 0.9411309 0.9940930 0.9910369 1.0139225
1959        NA                                                            
           Aug       Sep       Oct       Nov       Dec
1946        NA 1.0087166 1.0100993 0.9750198 0.9811991
1947 1.0347580 1.0801613 1.0598977 1.0148718 0.9505186
1948 0.9121156 1.0070903 1.0327771 1.0419388 1.0184171
1949 1.0050074 1.0005650 0.9547561 1.0113751 0.9801543
1950 1.0136262 1.0572700 1.0193511 1.0046941 0.9881470
1951 1.0004475 0.9829084 1.0004738 1.0322454 0.9371623
1952 0.9179537 0.9339544 0.9464591 0.9876150 1.0369545
1953 0.9675675 0.8977055 0.9434237 0.9812375 0.9946715
1954 1.0482632 1.0438847 1.1031294 1.0808234 1.1114310
1955 1.0386448 1.0116728 1.0271214 1.0307701 1.0343794
1956 0.9913209 0.9709560 0.9170729 0.9334055 1.0015335
1957 1.0562959 0.9898432 0.9701666 0.8907315 0.9501598
1958        NA        NA        NA        NA        NA
1959                                                  

$figure
 [1] 0.9100034 1.0290191 1.0606193 0.9827213 0.8919431 1.0176729 1.0509676
 [8] 1.0175704 0.9216109 1.0311689 1.0715541 1.0151491

$type
[1] "multiplicative"

attr(,"class")
[1] "decomposed.ts"</code></pre>
</div>
</div>
<div id="0deb22fd" class="cell" data-execution_count="57">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>plot(BricksTS_Dm)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="referencias" class="level1">
<h1>Referencias</h1>
<ul>
<li>https://rpubs.com/davoodastaraky/TSA1</li>
<li>https://www.kaggle.com/code/prashant111/complete-guide-on-time-series-analysis-in-python/notebook</li>
<li>https://link.springer.com/article/10.1007/s43069-022-00179-z</li>
</ul>
</section>
<section id="segunda-parte-acf-y-pacf" class="level1">
<h1>Segunda Parte ACF y PACF</h1>
<div id="d9b83ae4" class="cell" data-execution_count="70">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandas.plotting <span class="im">import</span> autocorrelation_plot</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="8bc2c9ee" class="cell" data-execution_count="71">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'figure.figsize'</span>:(<span class="dv">10</span>,<span class="dv">6</span>), <span class="st">'figure.dpi'</span>:<span class="dv">120</span>})</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>autocorrelation_plot(ejemplo2[<span class="st">"Bricks"</span>].tolist())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="985dca1b" class="cell" data-execution_count="72">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'figure.figsize'</span>:(<span class="dv">10</span>,<span class="dv">6</span>), <span class="st">'figure.dpi'</span>:<span class="dv">120</span>})</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>autocorrelation_plot(ejemplo3[<span class="st">"Kwh"</span>].tolist())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Simulemos un Ruido blanco para poder graficar son ACF</p>
<div id="bf3fe23c" class="cell" data-execution_count="74">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>n<span class="op">=</span><span class="dv">100</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>ruido <span class="op">=</span> np.random.rand(n)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>ruido_df<span class="op">=</span>pd.Series(ruido)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>plot_df(ruido_df, x<span class="op">=</span><span class="bu">range</span>(n), y<span class="op">=</span>ruido_df, title<span class="op">=</span><span class="st">'Ruido Blanco'</span>, colores<span class="op">=</span><span class="st">"blue"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-42-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="d6e0e207" class="cell" data-execution_count="75">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>autocorrelation_plot(ruido_df)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="db92b811" class="cell" data-execution_count="76">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>residuos2_1<span class="op">=</span> multiplicative_decomposition2.resid</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>autocorrelation_plot(residuos2_1.dropna())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-44-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="4ff9352c" class="cell" data-execution_count="77">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>residuos2_2<span class="op">=</span> additive_decomposition2.resid</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>autocorrelation_plot(residuos2_2.dropna())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-45-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="086ab0f9" class="cell" data-execution_count="78">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>residuos3_1<span class="op">=</span> multiplicative_decomposition3.resid</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>autocorrelation_plot(residuos3_1.dropna())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-46-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="67b262c4" class="cell" data-execution_count="79">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>residuos3_2<span class="op">=</span> additive_decomposition3.resid</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>autocorrelation_plot(residuos3_2.dropna())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-47-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Otro paquete que nos permite graficar la ACF y PACF es statsmodels</p>
<div id="a3638ed2" class="cell" data-execution_count="83">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> acf, pacf</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Graficas</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">3</span>), dpi<span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>plot_acf(residuos3_2.dropna(), lags<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>plot_pacf(residuos3_2.dropna(), lags<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="83">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-48-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-48-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1e43b053" class="cell" data-execution_count="84">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">3</span>), dpi<span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>plot_acf(ejemplo3[<span class="st">"Kwh"</span>].tolist(), lags<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>plot_pacf(ejemplo3[<span class="st">"Kwh"</span>].tolist(), lags<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="84">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-49-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-49-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="a6703edb" class="cell" data-execution_count="85">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">3</span>), dpi<span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>plot_acf(ruido, lags<span class="op">=</span><span class="dv">49</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>plot_pacf(ruido, lags<span class="op">=</span><span class="dv">49</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="85">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-50-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-50-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="92716687" class="cell" data-execution_count="86">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">3</span>), dpi<span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>plot_acf(residuos2_1.dropna(), lags<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>plot_pacf(residuos2_1.dropna(), lags<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-51-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-51-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="68604d19" class="cell" data-execution_count="87">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>,figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">3</span>), dpi<span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>plot_acf(residuos3_1.dropna(), lags<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>])</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>plot_pacf(residuos3_1.dropna(), lags<span class="op">=</span><span class="dv">50</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-52-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="acf-y-pacf-en-r" class="level2">
<h2 class="anchored" data-anchor-id="acf-y-pacf-en-r">ACF y PACF en R</h2>
<div id="39379836" class="cell" data-execution_count="89">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>acf(BricksTS)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-53-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="7c5887e2" class="cell" data-execution_count="88">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>R</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>pacf(BricksTS)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="sesion2_files/figure-html/cell-54-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="session" class="level1">
<h1>Session</h1>
<div id="2ae93ba9" class="cell" data-execution_count="103">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> session_info</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>session_info.show(html<span class="op">=</span><span class="va">False</span>,excludes<span class="op">=</span>[<span class="st">'dplyr'</span>,<span class="st">'readxl'</span>,<span class="st">'utils'</span>,<span class="st">'base'</span>,<span class="st">'stats'</span>,<span class="st">'lubridate'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>-----
ipywidgets          7.8.5
matplotlib          3.10.6
numpy               2.3.3
pandas              2.3.3
rpy2                NA
seaborn             0.13.2
session_info        v1.0.1
statsmodels         0.14.5
-----
IPython             9.6.0
jupyter_client      8.6.3
jupyter_core        5.8.1
jupyterlab          4.4.9
notebook            7.4.7
-----
Python 3.13.5 | packaged by conda-forge | (main, Jun 16 2025, 08:27:50) [GCC 13.3.0]
Linux-6.8.0-85-generic-x86_64-with-glibc2.39
-----
Session information updated at 2025-10-13 04:55</code></pre>
</div>
</div>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{e._ascencio_g.,
  author = {E. Ascencio G., Luis},
  title = {Taller - {Series} de {Tiempo} y {Python} {IIE} - {UNAM}},
  volume = {1},
  number = {1},
  doi = {000000/00000000},
  langid = {en},
  abstract = {Este Notebook incluye una introduccion al manejo de Series
    de Tiempo con Python}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-e._ascencio_g." class="csl-entry quarto-appendix-citeas" role="listitem">
E. Ascencio G., Luis. n.d. <span>“Taller - Series de Tiempo y Python IIE
- UNAM.”</span> CIMAT. <a href="https://doi.org/000000/00000000">https://doi.org/000000/00000000</a>.
</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>